DROP DATABASE IF EXISTS BD_CURSOS;
CREATE DATABASE BD_CURSOS  DEFAULT CHARACTER SET utf8 COLLATE utf8_spanish_ci;
GRANT ALL PRIVILEGES ON BD_CURSOS.* TO BD_CURSOS@localhost IDENTIFIED BY 'pepe';
USE BD_CURSOS;

CREATE TABLE CURSO (
   cod INT UNSIGNED AUTO_INCREMENT,
   nombre VARCHAR(30) NOT NULL,
   descripcion VARCHAR(40),
   n_horas SMALLINT UNSIGNED NOT NULL,
   coste SMALLINT UNSIGNED NOT NULL,
   PRIMARY KEY(cod)
) ENGINE=INNODB;

CREATE TABLE EDICION (
   cod_CURSO INT UNSIGNED,
   fecha DATE,
   PRIMARY KEY(cod_CURSO,fecha),
   FOREIGN KEY(cod_CURSO) REFERENCES CURSO(cod) ON UPDATE CASCADE
) ENGINE=INNODB;   

CREATE TABLE EMPLEADO (
   cod INT UNSIGNED AUTO_INCREMENT,
   nif CHAR(9) UNIQUE NOT NULL,
   nombre VARCHAR(30) NOT NULL,
   apellido1 VARCHAR(20) NOT NULL,
   apellido2 VARCHAR(20),
   dir VARCHAR(50) NOT NULL,
   telef INT(9) UNSIGNED NOT NULL,
   fecha_nac DATE,
   capacitado BIT NOT NULL,
   PRIMARY KEY(cod)
) ENGINE=INNODB;   

CREATE TABLE prerrequisitos (
   cod_CURSO INT UNSIGNED,
   prereq_CURSO INT UNSIGNED,
   obligatorio BIT NOT NULL,
   PRIMARY KEY(cod_CURSO,prereq_CURSO),
   FOREIGN KEY(cod_CURSO) REFERENCES CURSO(cod) ON UPDATE CASCADE,
   FOREIGN KEY(prereq_CURSO) REFERENCES CURSO(cod) ON UPDATE CASCADE
) ENGINE=INNODB;

CREATE TABLE participa(
   cod_EDICION INT UNSIGNED,
   fecha_EDICION INT UNSIGNED,
   cod_EMPLEADO INT UNSIGNED,
   docente BIT NOT NULL,
   PRIMARY KEY(cod_EDICION,fecha_EDICION,cod_EMPLEADO),
   FOREIGN KEY(cod_EDICION,fecha_EDICION) REFERENCES EDICION(cod_CURSO,fecha) ON UPDATE CASCADE,
   FOREIGN KEY(cod_EMPLEADO) REFERENCES EMPLEADO(cod) ON UPDATE CASCADE
) ENGINE=INNODB;





