#!/bin/bash

uso() {
   cat<<EOF
   Uso: $0 <on|off>
   on: Pone direcciÃ³n fija en este servidor
   off: Pone DHCP
EOF
   exit 1
}
if [ "$1" = "" ]; then uso; fi
if [ "$(whoami)" != "root" ]; then sudo $0 $@; exit $?; fi
MAC=$(ifconfig eth1 | head -1 | awk '{print $NF;}')
INTERFAZ=eth1
if [ "$MAC" = "00:24:01:ed:30:c1" ]; then IP=2; 
elif [ "$MAC" = "00:19:99:88:6a:f8" ]; then IP=1; 
else echo "Error no encuentro MAC"; exit 2; fi

if [ "$1" = "on" ]; then
   killall dhclient &>/dev/null
   ROUTER=172.18.161.1
   ifconfig $INTERFAZ 172.18.161.25$IP/24
   #route del default gw
   route add default gw $ROUTER &> /dev/null
   #chattr -i /etc/resolv.conf
   echo "nameserver 172.27.111.5
nameserver 172.27.111.6
search aula1" > /etc/resolv.conf 
   #chattr +i /etc/resolv.conf
else
   #chattr -i /etc/resolv.conf
   echo "# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 127.0.0.1
search aula1
" > /etc/resolv.conf 
   dhclient -1 -v -pf /run/dhclient.eth1.pid -lf /var/lib/dhcp/dhclient.eth1.leases eth1 &> /dev/null &
fi   
