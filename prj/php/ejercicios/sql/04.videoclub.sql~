DROP DATABASE IF EXISTS BD_VIDEOCLUB;
CREATE DATABASE BD_VIDEOCLUB  DEFAULT CHARACTER SET utf8 COLLATE utf8_spanish_ci;
GRANT ALL PRIVILEGES ON BD_VIDEOCLUB.* TO BD_VIDEOCLUB@localhost IDENTIFIED BY 'video2009';

use BD_VIDEOCLUB;

CREATE TABLE CLIENTE (
   nif CHAR(9),
   nombre VARCHAR(20) NOT NULL,
   apellido1 VARCHAR(20) NOT NULL,
   apellido2 VARCHAR(20),
   dir VARCHAR(50),
   telef CHAR(9) NOT NULL,
   PRIMARY KEY(nif)
) ENGINE=INNODB;

CREATE TABLE PELICULA (
   id INT UNSIGNED AUTO_INCREMENT,
   titulo VARCHAR(35) NOT NULL,
   director VARCHAR(20) NOT NULL,
   anio INT(4) NOT NULL,
   duracion INT(3) NOT NULL,
   genero VARCHAR(30) NOT NULL,
   sinopsis VARCHAR(500) NOT NULL,
   PRIMARY KEY(id)
) ENGINE=INNODB;
   
CREATE TABLE EJEMPLAR (
   id_PELICULA INT UNSIGNED,
   n_ejemplar TINYINT UNSIGNED,
   disponible BIT,
   PRIMARY KEY(id_PELICULA,n_ejemplar),
   FOREIGN KEY(id_PELICULA) references PELICULA(id) ON UPDATE CASCADE
) ENGINE=INNODB;

CREATE TABLE BONO(
   id TINYINT UNSIGNED AUTO_INCREMENT,
   tipo CHAR(8),
   duracion smallINT UNSIGNED,
   precio REAL,
   PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE PROVEEDOR (
   nif CHAR(9),
   nombre VARCHAR(30),
   dir VARCHAR(35),
   telef CHAR(9),
   PRIMARY KEY(nif)
)ENGINE=INNODB;

CREATE TABLE PEDIDO (
   id INT UNSIGNED AUTO_INCREMENT,
   fecha DATE,
   nif_PROVEEDOR CHAR(9),
   PRIMARY KEY(id),
   FOREIGN KEY(nif_PROVEEDOR) references PROVEEDOR(nif) ON UPDATE CASCADE 
)ENGINE=INNODB;

CREATE TABLE FACTURA (
   id INT UNSIGNED AUTO_INCREMENT,
   fecha DATE,
   id_PEDIDO INT UNSIGNED,
   PRIMARY KEY(id),
   FOREIGN KEY(id_PEDIDO) REFERENCES PEDIDO(id) ON UPDATE CASCADE
)ENGINE=INNODB;

CREATE TABLE PAGO (
   id_FACTURA INT UNSIGNED,
   num_pago TINYINT UNSIGNED,
   cantidad INT UNSIGNED,   
   PRIMARY KEY(id_FACTURA,num_pago),
   FOREIGN KEY(id_FACTURA) references FACTURA(id) ON UPDATE CASCADE 
)ENGINE=INNODB;

CREATE TABLE ENTREGA (
   id_PEDIDO INT UNSIGNED,
   num_entrega TINYINT UNSIGNED,
   fecha_entrega DATE,
   PRIMARY KEY(id_PEDIDO,num_entrega),
   FOREIGN KEY(id_PEDIDO) references PEDIDO(id) ON UPDATE CASCADE 
)ENGINE=INNODB;

CREATE TABLE alquiler (
   nif_CLIENTE CHAR(9),
   id_EJEMPLAR INT UNSIGNED,
   n_ejemplar_EJEMPLAR TINYINT UNSIGNED,
   id_BONO TINYINT UNSIGNED,
   fecha_alq DATETIME,
   fecha_dev DATETIME NOT NULL,
   importe INT UNSIGNED NOT NULL,
   sancion INT UNSIGNED,
   PRIMARY KEY(nif_CLIENTE,id_EJEMPLAR,n_ejemplar_EJEMPLAR,fecha_alq),
   FOREIGN KEY(nif_CLIENTE) REFERENCES CLIENTE(nif) ON UPDATE CASCADE,
   FOREIGN KEY(id_EJEMPLAR,n_ejemplar_EJEMPLAR) REFERENCES EJEMPLAR(id_PELICULA,n_ejemplar) ON UPDATE CASCADE,
   FOREIGN KEY(id_BONO) REFERENCES BONO(id) ON UPDATE CASCADE
) ENGINE=INNODB;   

CREATE TABLE compra (
   nif_CLIENTE CHAR(9),
   id_BONO TINYINT UNSIGNED,
   fecha DATETIME,
   cant TINYINT UNSIGNED,
   PRIMARY KEY(nif_CLIENTE,id_BONO,fecha),
   FOREIGN KEY(nif_CLIENTE) REFERENCES CLIENTE(nif) ON UPDATE CASCADE,
   FOREIGN KEY(id_BONO) REFERENCES BONO(id) ON UPDATE CASCADE
) ENGINE=INNODB;

CREATE TABLE posee (
   nif_CLIENTE CHAR(9),
   id_BONO TINYINT UNSIGNED,
   cantidad TINYINT UNSIGNED,
   PRIMARY KEY(nif_CLIENTE,id_BONO),
   FOREIGN KEY(nif_CLIENTE) REFERENCES CLIENTE(id) ON UPDATE CASCADE,
   FOREIGN KEY(id_BONO) REFERENCES BONO(id) ON UPDATE CASCADE
) ENGINE=INNODB;

CREATE TABLE pedido_pelicula (
   id_PEDIDO INT UNSIGNED,
   id_PELICULA INT UNSIGNED,
   PRIMARY KEY(id_PEDIDO,id_PELICULA),
   FOREIGN KEY(id_PEDIDO) REFERENCES PEDIDO(id) ON UPDATE CASCADE,
   FOREIGN KEY(id_PELICULA) REFERENCES PELICULA(id) ON UPDATE CASCADE
) ENGINE=INNODB;

CREATE TABLE entrega_pelicula (
   id_ENTREGA INT UNSIGNED,
   num_entrega_ENTREGA TINYINT UNSIGNED,
   id_PELICULA INT UNSIGNED,
   cantidad TINYINT UNSIGNED,
   PRIMARY KEY(id_ENTREGA,num_entrega_ENTREGA,id_PELICULA),
   FOREIGN KEY(id_ENTREGA,num_entrega_ENTREGA) REFERENCES ENTREGA(id_PEDIDO,num_entrega) ON UPDATE CASCADE,
   FOREIGN KEY(id_PELICULA) REFERENCES PELICULA(id) ON UPDATE CASCADE
) ENGINE=INNODB;

   
   
      
